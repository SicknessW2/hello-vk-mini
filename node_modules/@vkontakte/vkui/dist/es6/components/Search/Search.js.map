{"version":3,"sources":["../../../../src/components/Search/Search.tsx"],"names":["React","Component","classNames","withPlatform","getClassname","Icon16SearchOutline","IOS","searchId","Search","props","e","setState","focused","onFocus","onBlur","target","isControlledOutside","value","onChange","nativeInputValueSetter","Object","getOwnPropertyDescriptor","window","HTMLInputElement","prototype","set","call","inputEl","ev2","Event","bubbles","dispatchEvent","element","getRef","current","state","hasOwnProperty","defaultValue","className","placeholder","after","platform","inputProps","inputRef","__html","onCancel","autoComplete"],"mappings":"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","sourcesContent":["import React, {\n  Component,\n  ReactNode,\n  FocusEvent,\n  FocusEventHandler,\n  InputHTMLAttributes,\n  ChangeEvent,\n  ChangeEventHandler,\n} from 'react';\nimport classNames from '../../lib/classNames';\nimport withPlatform from '../../hoc/withPlatform';\nimport getClassname from '../../helpers/getClassName';\nimport Icon16SearchOutline from '@vkontakte/icons/dist/16/search_outline';\nimport { IOS } from '../../lib/platform';\nimport { HasPlatform, HasRef } from '../../types/props';\n\nlet searchId = 0;\n\nexport type InputRef = (element: HTMLInputElement) => void;\n\nexport type CancelHandler = () => void;\n\nexport interface SearchProps extends InputHTMLAttributes<HTMLInputElement>, HasRef<HTMLInputElement>, HasPlatform {\n  /**\n   * iOS only. Текст кнопки \"отмена\", которая чистит текстовое поле и убирает фокус.\n   */\n  after?: ReactNode;\n  defaultValue?: string;\n}\n\nexport interface SearchState {\n  value?: string;\n  focused?: boolean;\n}\n\nclass Search extends Component<SearchProps, SearchState> {\n  static defaultProps: SearchProps = {\n    autoComplete: 'off',\n    placeholder: 'Поиск',\n    after: 'Отмена',\n  };\n\n  isControlledOutside: boolean;\n\n  inputEl: HTMLInputElement;\n\n  constructor(props: SearchProps) {\n    super(props);\n\n    const state: SearchState = {\n      focused: false,\n    };\n\n    if (props.hasOwnProperty('value')) {\n      this.isControlledOutside = true;\n    } else {\n      state.value = props.defaultValue || '';\n    }\n    searchId++;\n    this.state = state;\n  }\n\n  get value() {\n    return this.isControlledOutside ? this.props.value : this.state.value;\n  }\n\n  onFocus: FocusEventHandler = (e: FocusEvent<HTMLInputElement>) => {\n    this.setState({ focused: true });\n    this.props.onFocus && this.props.onFocus(e);\n  };\n\n  onBlur: FocusEventHandler = (e: FocusEvent<HTMLInputElement>) => {\n    this.setState({ focused: false });\n    this.props.onBlur && this.props.onBlur(e);\n  };\n\n  onChange: ChangeEventHandler = (e?: ChangeEvent<HTMLInputElement>) => {\n    const target = e.target as HTMLInputElement;\n    if (!this.isControlledOutside) {\n      this.setState({ value: target.value });\n    }\n    if (this.props.onChange) {\n      this.props.onChange(e);\n    }\n  };\n\n  onCancel: CancelHandler = () => {\n    // eslint-disable-next-line @typescript-eslint/unbound-method\n    const nativeInputValueSetter = Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype, 'value').set;\n    nativeInputValueSetter.call(this.inputEl, '');\n\n    const ev2 = new Event('input', { bubbles: true });\n    this.inputEl.dispatchEvent(ev2);\n  };\n\n  inputRef: InputRef = (element: HTMLInputElement) => {\n    const getRef = this.props.getRef;\n    this.inputEl = element;\n    if (getRef) {\n      if (typeof getRef === 'function') {\n        getRef(element);\n      } else {\n        getRef.current = element;\n      }\n    }\n  };\n\n  render() {\n    const {\n      className,\n      onFocus,\n      onBlur,\n      onChange,\n      defaultValue,\n      value,\n      placeholder,\n      after,\n      getRef,\n      platform,\n      ...inputProps\n    } = this.props;\n\n    return (\n      <div className={classNames(getClassname('Search', platform), {\n        'Search--focused': this.state.focused,\n        'Search--has-value': !!this.value,\n        'Search--has-after': !!after,\n      }, className)}>\n        <div className=\"Search__in\">\n          <div className=\"Search__width\" />\n          <div className=\"Search__control\">\n            <input\n              {...inputProps}\n              id={`search-${searchId}`}\n              ref={this.inputRef}\n              type=\"text\"\n              className=\"Search__input\"\n              onFocus={this.onFocus}\n              onBlur={this.onBlur}\n              onChange={this.onChange}\n              value={this.value}\n            />\n            {platform === IOS && after && <div className=\"Search__after-width\">{after}</div>}\n            <label\n              className=\"Search__placeholder\"\n              htmlFor={`search-${searchId}`}\n            >\n              <div className=\"Search__placeholder-in\">\n                <Icon16SearchOutline />\n                <div className=\"Search__placeholder-text\" dangerouslySetInnerHTML={{ __html: placeholder }} />\n              </div>\n            </label>\n          </div>\n          {platform === IOS && after &&\n            <div className=\"Search__after\" onClick={this.onCancel}>\n              <div className=\"Search__after-in\">{after}</div>\n            </div>\n          }\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default withPlatform(Search);\n"],"file":"Search.js"}